---
title: Tâche de nettoyage des entrées disponibles de la gestion de l'entrepôt
description: Cette rubrique décrit la tâche de nettoyage des entrées disponibles, qui permet d'améliorer les performances du système en identifiant et en supprimant les enregistrements associés mais inutiles.
author: perlynne
manager: tfehr
ms.date: 04/23/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: SysOperationTemplateForm
audience: Application User
ms.reviewer: kamaybac
ms.search.scope: Core, Operations
ms.search.region: Global
ms.author: perlynne
ms.search.validFrom: 2020-04-03
ms.dyn365.ops.version: Release 10.0.12
ms.openlocfilehash: 9d01c577fc33564d3517d242e9b01f73cc8e079c
ms.sourcegitcommit: 827d77c638555396b32d36af5d22d1b61dafb0e8
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/16/2020
ms.locfileid: "4428273"
---
# <a name="warehouse-management-on-hand-entries-cleanup-job"></a><span data-ttu-id="4cc85-103">Tâche de nettoyage des entrées disponibles de la gestion de l'entrepôt</span><span class="sxs-lookup"><span data-stu-id="4cc85-103">Warehouse management on-hand entries cleanup job</span></span>

<span data-ttu-id="4cc85-104">Les performances des requêtes utilisées pour calculer l'inventaire disponible sont affectées par le nombre d'enregistrements dans les tables impliquées.</span><span class="sxs-lookup"><span data-stu-id="4cc85-104">The performance of queries that are used to calculate on-hand inventory is affected by the number of records in the tables that are involved.</span></span> <span data-ttu-id="4cc85-105">Une façon d'améliorer les performances consiste à réduire le nombre d'enregistrements que la base de données doit prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="4cc85-105">One way to help improve the performance is to reduce the number of records that the database must consider.</span></span>

<span data-ttu-id="4cc85-106">Cette rubrique décrit la tâche de nettoyage des entrées disponibles, qui supprime les enregistrements inutiles dans les tables InventSum et WHSInventReserve.</span><span class="sxs-lookup"><span data-stu-id="4cc85-106">This topic describes the on-hand entries cleanup job, which deletes unneeded records in the InventSum and WHSInventReserve tables.</span></span> <span data-ttu-id="4cc85-107">Ces tables stockent les informations de disponibilité pour les articles activés pour le traitement de gestion d'entrepôt.</span><span class="sxs-lookup"><span data-stu-id="4cc85-107">These tables store on-hand information for items that are enabled for warehouse management processing.</span></span> <span data-ttu-id="4cc85-108">(Ces éléments sont appelés éléments WHS.) La suppression de ces enregistrements peut améliorer considérablement les performances des calculs de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="4cc85-108">(These items are referred to as WHS items.) Deletion of these records can significantly improve the performance of on-hand calculations.</span></span>

## <a name="what-the-cleanup-job-does"></a><span data-ttu-id="4cc85-109">Ce que fait la tâche de nettoyage</span><span class="sxs-lookup"><span data-stu-id="4cc85-109">What the cleanup job does</span></span>

<span data-ttu-id="4cc85-110">La tâche de nettoyage des entrées disponibles supprime tous les enregistrements des tables WHSInventReserve et InventSum dont toutes les valeurs de champ sont *0* (zéro).</span><span class="sxs-lookup"><span data-stu-id="4cc85-110">The on-hand entries cleanup job deletes any records in the WHSInventReserve and InventSum tables where all the field values are *0* (zero).</span></span> <span data-ttu-id="4cc85-111">Ces enregistrements peuvent être supprimés car ils ne contribuent pas aux informations de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="4cc85-111">These records can be deleted because they don't contribute to the on-hand information.</span></span> <span data-ttu-id="4cc85-112">La tâche supprime uniquement les enregistrements qui se trouvent en-dessous du niveau **Emplacement**.</span><span class="sxs-lookup"><span data-stu-id="4cc85-112">The job deletes only records that are below the **Location** level.</span></span>

<span data-ttu-id="4cc85-113">Si le stock physique négatif est autorisé, la tâche de nettoyage peut ne pas être en mesure de supprimer toutes les entrées pertinentes.</span><span class="sxs-lookup"><span data-stu-id="4cc85-113">If negative physical inventory is allowed, the cleanup job might not be able to delete all the relevant entries.</span></span> <span data-ttu-id="4cc85-114">La raison de cette limitation est que la tâche doit autoriser un scénario spécial où un contenant contient plusieurs numéros de série et où l'un de ces numéros de série est devenu négatif.</span><span class="sxs-lookup"><span data-stu-id="4cc85-114">The reason for this limitation is that the job must allow for a special scenario where a license plate has multiple serial numbers, and one of those serial numbers has become negative.</span></span> <span data-ttu-id="4cc85-115">Par exemple, le système aura une disponibilité zéro au niveau du contenant lorsqu'un contenant aura +1 pièces du numéro de série 1 et –1 pièces du numéro de série 2.</span><span class="sxs-lookup"><span data-stu-id="4cc85-115">For example, the system will have zero on hand at the license plate level when a license plate has +1 pcs of serial number 1 and –1 pcs of serial number 2.</span></span> <span data-ttu-id="4cc85-116">Pour ce scénario spécial, la tâche effectue d'abord une suppression globale, où elle essaie de supprimer en partant des niveaux inférieurs.</span><span class="sxs-lookup"><span data-stu-id="4cc85-116">For this special scenario, the job does a breadth-first deletion, where it tries to delete from lower levels first.</span></span>

## <a name="schedule-and-configure-the-cleanup-job"></a><span data-ttu-id="4cc85-117">Programmer et configurer la tâche de nettoyage</span><span class="sxs-lookup"><span data-stu-id="4cc85-117">Schedule and configure the cleanup job</span></span>

<span data-ttu-id="4cc85-118">La tâche de nettoyage des entrées disponibles est disponible dans **Gestion des stocks \> Tâches périodiques \> Nettoyage \> Nettoyage des entrées disponibles de la gestion de l'entrepôt**.</span><span class="sxs-lookup"><span data-stu-id="4cc85-118">The on-hand entries cleanup job is available at **Inventory management \> Periodic tasks \> Clean up \> Warehouse management on-hand entries cleanup**.</span></span> <span data-ttu-id="4cc85-119">Utilisez les paramètres de tâche standard pour contrôler la portée et le programme d'exécution de la tâche.</span><span class="sxs-lookup"><span data-stu-id="4cc85-119">Use the standard job settings to control the scope and schedule for running the job.</span></span> <span data-ttu-id="4cc85-120">En outre, les paramètres suivants sont fournis :</span><span class="sxs-lookup"><span data-stu-id="4cc85-120">In addition, the following settings are provided:</span></span>

- <span data-ttu-id="4cc85-121">**Supprimer s'il n'y a pas eu de mise à jour depuis plusieurs jours** – Entrez le nombre minimum de jours à attendre avant de supprimer une entrée disponible qui est tombée à zéro.</span><span class="sxs-lookup"><span data-stu-id="4cc85-121">**Delete if not updated for this many days** – Enter the minimum number of days that the job should wait before it deletes an on-hand entry that has dropped to zero quantity.</span></span> <span data-ttu-id="4cc85-122">Utilisez ce paramètre pour réduire le risque de supprimer des entrées disponibles qui sont toujours utilisées.</span><span class="sxs-lookup"><span data-stu-id="4cc85-122">Use this setting to help reduce the risk of deleting on-hand entries that are still being used.</span></span> <span data-ttu-id="4cc85-123">Si vous souhaitez que le nettoyage soit effectué dès que possible, entrez *0* (zéro) ou laissez le champ vide.</span><span class="sxs-lookup"><span data-stu-id="4cc85-123">If you want cleanup to occur as soon as possible, either enter *0* (zero) or leave the field blank.</span></span>
- <span data-ttu-id="4cc85-124">**Durée d'exécution maximale (heures)** – Entrez la durée d'exécution maximale de la tâche de nettoyage, en heures.</span><span class="sxs-lookup"><span data-stu-id="4cc85-124">**Maximum execution time (hours)** – Enter the maximum execution time of the cleanup job, in hours.</span></span> <span data-ttu-id="4cc85-125">Si la tâche n'est pas terminée avant la fin de ce délai, elle enregistrera le travail effectué jusqu'à présent, puis se fermera.</span><span class="sxs-lookup"><span data-stu-id="4cc85-125">If the job isn't completed before this time passes, it will save the work that it has completed so far and then close itself.</span></span> <span data-ttu-id="4cc85-126">Cette capacité est particulièrement pertinente pour les implémentations où le stock est important.</span><span class="sxs-lookup"><span data-stu-id="4cc85-126">This capability is especially relevant for implementations that have high inventory use.</span></span> <span data-ttu-id="4cc85-127">Dans ces cas, vous devez programmer l'exécution de la tâche aux heures où la charge du système est aussi légère que possible.</span><span class="sxs-lookup"><span data-stu-id="4cc85-127">In these cases, you should schedule the job to run at times when the system load is as light as possible.</span></span> <span data-ttu-id="4cc85-128">Si vous souhaitez que le traitement par lots continue de s'exécuter jusqu'à sa fin, entrez *0* (zéro) ou laissez le champ vide.</span><span class="sxs-lookup"><span data-stu-id="4cc85-128">If you want the batch job to continue to run until it's completed, either enter *0* (zero) or leave the field blank.</span></span> <span data-ttu-id="4cc85-129">Ce paramètre n'est disponible que si la fonctionnalité associée a été [activée dans votre système](#max-execution-time).</span><span class="sxs-lookup"><span data-stu-id="4cc85-129">This setting is available only if the related feature has been [turned on in your system](#max-execution-time).</span></span>

<span data-ttu-id="4cc85-130">Bien que vous puissiez exécuter la tâche pendant les heures ouvrées normales, nous vous recommandons de l'exécuter en dehors des heures de travail.</span><span class="sxs-lookup"><span data-stu-id="4cc85-130">Although you can run the job during regular business hours, we recommend that you run it outside working hours.</span></span> <span data-ttu-id="4cc85-131">De cette façon, vous évitez les conflits qui peuvent se produire si un utilisateur travaille avec un enregistrement qui est également en cours de nettoyage.</span><span class="sxs-lookup"><span data-stu-id="4cc85-131">In this way, you help prevent conflicts that can occur if a user is working with a record that is also being cleaned up.</span></span>

<span data-ttu-id="4cc85-132">Si la tâche tente de supprimer un enregistrement d'un élément alors que cet enregistrement est utilisé par un autre utilisateur, une erreur de blocage se produit pour la tâche de nettoyage ou pour l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4cc85-132">If the job tries to delete a record for an item while that record is being used by another user, a deadlock error occurs for either the cleanup job or the user.</span></span>

<span data-ttu-id="4cc85-133">Lorsque la tâche s'exécute, sa taille de validation est 100.</span><span class="sxs-lookup"><span data-stu-id="4cc85-133">When the job runs, it has a commit size of 100.</span></span> <span data-ttu-id="4cc85-134">Cela signifie qu'elle essaiera d'opérer la validation toutes les 100 suppressions.</span><span class="sxs-lookup"><span data-stu-id="4cc85-134">In other words, it will try to commit one time for every 100 deletions.</span></span> <span data-ttu-id="4cc85-135">Cependant, comme certaines suppressions sont basées sur des ensembles, il peut exister des scénarios dans lesquels plus de 100 enregistrements peuvent être supprimés dans la même transaction.</span><span class="sxs-lookup"><span data-stu-id="4cc85-135">However, because some deletions are set-based, there might be scenarios where more than 100 records can be deleted in the same transaction.</span></span> <span data-ttu-id="4cc85-136">Par conséquent, des remontées de blocage peuvent parfois se produire.</span><span class="sxs-lookup"><span data-stu-id="4cc85-136">Therefore, lock escalations can still sometimes occur.</span></span>

## <a name="possible-user-impact"></a><span data-ttu-id="4cc85-137">Impact possible pour l'utilisateur</span><span class="sxs-lookup"><span data-stu-id="4cc85-137">Possible user impact</span></span>

<span data-ttu-id="4cc85-138">Les utilisateurs peuvent être affectés si la tâche de nettoyage des entrées disponibles supprime tous les enregistrements d'un niveau donné (tel que le niveau de contenant).</span><span class="sxs-lookup"><span data-stu-id="4cc85-138">Users might be affected if the on-hand entries cleanup job deletes all the records for a given level (such as the license plate level).</span></span> <span data-ttu-id="4cc85-139">Dans ce cas, la fonctionnalité permettant de voir que le stock était auparavant disponible dans un contant peut ne pas fonctionner comme prévu, car les entrées disponibles pertinentes ne sont plus disponibles.</span><span class="sxs-lookup"><span data-stu-id="4cc85-139">In this case, the functionality for seeing that inventory was previously available on hand at a license plate might not work as expected, because the relevant on-hand entries are no longer available.</span></span> <span data-ttu-id="4cc85-140">(Cette fonctionnalité vérifie la condition **Quantité \<\> 0** dans les paramètres **Affichage des dimensions** lorsque les utilisateurs affichent les informations de disponibilité.) Cependant, l'amélioration des performances offerte par la tâche de nettoyage doit compenser cette petite perte de fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="4cc85-140">(That functionality checks the condition **Quantity \<\> 0** in the **Dimension display** settings when users view on-hand information.) However, the performance improvement that the cleanup job provides should make up for this small loss in functionality.</span></span>

## <a name="make-the-maximum-execution-time-setting-available"></a><a name="max-execution-time"></a><span data-ttu-id="4cc85-141">Rendre disponible le paramètre Durée maximale d'exécution</span><span class="sxs-lookup"><span data-stu-id="4cc85-141">Make the Maximum execution time setting available</span></span>

<span data-ttu-id="4cc85-142">Par défaut, le paramètre **Durée maximale d'exécution** n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="4cc85-142">By default, the **Maximum execution time** setting isn't available.</span></span> <span data-ttu-id="4cc85-143">Si vous voulez l'utiliser, vous devez utiliser la [gestion des fonctionnalités](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) pour activer la fonction associée dans votre système.</span><span class="sxs-lookup"><span data-stu-id="4cc85-143">If you want to use it, you must use [feature management](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) to turn on the related feature in your system.</span></span> <span data-ttu-id="4cc85-144">Dans l'espace de travail **Gestion des fonctionnalités**, la fonctionnalité est répertoriée comme suit :</span><span class="sxs-lookup"><span data-stu-id="4cc85-144">In the **Feature management** workspace, the feature is listed in the following way:</span></span>

- <span data-ttu-id="4cc85-145">**Module :** *Gestion des entrepôts*</span><span class="sxs-lookup"><span data-stu-id="4cc85-145">**Module:** *Warehouse management*</span></span>
- <span data-ttu-id="4cc85-146">**Nom de la fonctionnalité :** *Durée d'exécution maximale pour la tâche de nettoyage des entrées disponibles de gestion de l'entrepôt*</span><span class="sxs-lookup"><span data-stu-id="4cc85-146">**Feature name:** *Maximum execution time for the warehouse management on-hand entries cleanup job*</span></span>
