---
title: Nettoyage de migration ER
description: Cette rubrique explique comment utiliser la fonction de nettoyage de migration ER pour résoudre des problèmes avec les modèles ER.
author: NickSelin
manager: AnnBe
ms.date: 04/29/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: ERSolutionTable, ERWorkspace, ERParameters, ERMigrationCleanup
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2018-01-01
ms.dyn365.ops.version: AX 8.0.0
ms.openlocfilehash: 090badd48785dfacf5942426d0fe53629f3c0cda
ms.sourcegitcommit: 5de75c61c33e57c813944f1ab6100aceb020d432
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/29/2020
ms.locfileid: "3321800"
---
# <a name="er-migration-cleanup"></a><span data-ttu-id="b3c63-103">Nettoyage de migration ER</span><span class="sxs-lookup"><span data-stu-id="b3c63-103">ER migration cleanup</span></span> 

[!include[banner](../includes/banner.md)]

<span data-ttu-id="b3c63-104">Lorsque vous gérez vos instances Finance, vous pouvez décider de migrer votre instance actuelle vers un autre emplacement.</span><span class="sxs-lookup"><span data-stu-id="b3c63-104">When you manage your Finance instances, you might decide to migrate your current instance to another location.</span></span> <span data-ttu-id="b3c63-105">Par exemple, vous pouvez migrer votre instance de production vers un nouvel environnement de bac à sable.</span><span class="sxs-lookup"><span data-stu-id="b3c63-105">For example, you might migrate your production instance to a new sandbox environment.</span></span> <span data-ttu-id="b3c63-106">So vous n'avez pas configuré la structure de la gestion des états électroniques (ER) pour stocker les modèles dans un stockage d'objets blob Microsoft Azure, la table **DocuValue** du nouvel environnement de bac à sable fait référence à l'instance de stockage d'objets blob dans l'environnement de production.</span><span class="sxs-lookup"><span data-stu-id="b3c63-106">If you configured the Electronic reporting (ER) framework to store templates in Microsoft Azure Blob storage, the **DocuValue** table in the new sandbox environment refers to the instance of Blob storage in the production environment.</span></span> <span data-ttu-id="b3c63-107">Cependant, cette instance n'est pas accessible depuis l'environnement de bac à sable, car le processus de migration n'est pas compatible avec la migration des artefacts dans le stockage d'objets blob.</span><span class="sxs-lookup"><span data-stu-id="b3c63-107">However, this instance can't be accessed from the sandbox environment because the migration process doesn't support the migration of artifacts in Blob storage.</span></span> <span data-ttu-id="b3c63-108">On s'attend plutôt à ce que dans le nouvel environnement sandbox, vous vous référiez à l'instance de stockage Blob dans l'environnement sandbox qui n'obtient pas encore les modèles ER.</span><span class="sxs-lookup"><span data-stu-id="b3c63-108">Rather, it's expected that in the new sandbox environment, you refer to the instance of Blob storage in the sandbox environment that does not yet obtain the ER templates.</span></span>

<span data-ttu-id="b3c63-109">Si vous essayez d'exécuter un format de gestion d'états électroniques qui utilise un modèle pour générer des documents commerciaux, une exception survient et vous êtes averti du modèle manquant.</span><span class="sxs-lookup"><span data-stu-id="b3c63-109">If you try to run an ER format that uses a template to generate business documents, an exception occurs, and you're notified about the missing template.</span></span> <span data-ttu-id="b3c63-110">Vous êtes également invité à utiliser l'option de nettoyage de migration pour supprimer, puis réimporter la configuration du format des états électroniques qui contient le modèle.</span><span class="sxs-lookup"><span data-stu-id="b3c63-110">You're also guided to use the ER migration cleanup option to delete and then re-import the ER format configuration that contains the template.</span></span>

<span data-ttu-id="b3c63-111">[![Exécution d'un format ER](./media/er-migration-cleanup-run.png)](./media/er-migration-cleanup-run.png)</span><span class="sxs-lookup"><span data-stu-id="b3c63-111">[![Running an ER format](./media/er-migration-cleanup-run.png)](./media/er-migration-cleanup-run.png)</span></span>

<span data-ttu-id="b3c63-112">Vous recevrez une erreur similaire si vous accédez à la page **Configurations** (**Administration de l'organisation** \> **Rapports électroniques** \> **Configurations**) et dans l'arborescence des configurations, essayez de supprimer une configuration au format ER qui utilise un modèle.</span><span class="sxs-lookup"><span data-stu-id="b3c63-112">You will receive a similar error if you navigate to the **Configurations** page (**Organization administration** \> **Electronic reporting** \> **Configurations**) and in the configurations tree, try to delete an ER format configuration that uses a template.</span></span>

<span data-ttu-id="b3c63-113">[![Suppression d'un format ER](./media/er-migration-cleanup-delete.png)](./media/er-migration-cleanup-delete.png)</span><span class="sxs-lookup"><span data-stu-id="b3c63-113">[![Deletion an ER format](./media/er-migration-cleanup-delete.png)](./media/er-migration-cleanup-delete.png)</span></span>

<span data-ttu-id="b3c63-114">Effectuez les étapes suivantes pour résoudre les problèmes avec les modèles ER auxquels vous ne pouvez pas accéder.</span><span class="sxs-lookup"><span data-stu-id="b3c63-114">Complete the following steps to resolve issues with ER templates that you are unable to access.</span></span>

1.  <span data-ttu-id="b3c63-115">Accédez à la page **Administration de l'organisation** \> **Périodique** \> **Nettoyage de la migration**.</span><span class="sxs-lookup"><span data-stu-id="b3c63-115">Go to **Organization administration** \> **Periodic** \> **Migration cleanup** page.</span></span>
2.  <span data-ttu-id="b3c63-116">Sélectionnez une configuration au format ER qui ne peut pas être exécutée ou supprimée.</span><span class="sxs-lookup"><span data-stu-id="b3c63-116">Select an ER format configuration that can’t be executed or deleted.</span></span>
3.  <span data-ttu-id="b3c63-117">Sélectionnez **Supprimer**.</span><span class="sxs-lookup"><span data-stu-id="b3c63-117">Select **Delete**.</span></span>
4.  <span data-ttu-id="b3c63-118">Confirmez la suppression de la configuration de format ER sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="b3c63-118">Confirm the deletion of the selected ER format configuration.</span></span>
5.  <span data-ttu-id="b3c63-119">[Importez](download-electronic-reporting-configuration-lcs.md) la configuration de format ER supprimée vers l'instance Finance actuelle.</span><span class="sxs-lookup"><span data-stu-id="b3c63-119">[Import](download-electronic-reporting-configuration-lcs.md) the deleted ER format configuration to the current Finance instance.</span></span>

## <a name="applicability"></a><span data-ttu-id="b3c63-120">Conditions d'application</span><span class="sxs-lookup"><span data-stu-id="b3c63-120">Applicability</span></span>

> <span data-ttu-id="b3c63-121">[Important] L'option **Nettoyage de la migration** est ciblée uniquement pour les configurations de format ER qui contiennent des modèles ER non accessibles.</span><span class="sxs-lookup"><span data-stu-id="b3c63-121">[Important] The **Migration cleanup** option is targeted only for ER format configurations that contain non-accessible ER templates.</span></span> <span data-ttu-id="b3c63-122">Lorsque vous supprimez une configuration au format ER à l'aide de l'option **Nettoyage de la migration**, ER supprime les modèles liés aux artefacts de configuration dans la seule base de données d'application.</span><span class="sxs-lookup"><span data-stu-id="b3c63-122">When you delete an ER format configuration by using the **Migration cleanup** option, ER deletes the templates that are related to the configuration artifacts in the only application database.</span></span> <span data-ttu-id="b3c63-123">L'existence des fichiers physiques appropriés dans le stockage Blob n'est pas validée.</span><span class="sxs-lookup"><span data-stu-id="b3c63-123">The existence of the appropriate physical files in Blob storage are not validated.</span></span> <span data-ttu-id="b3c63-124">Au lieu de cela, on suppose qu'il n'y en a pas.</span><span class="sxs-lookup"><span data-stu-id="b3c63-124">Instead, it is assumed that there are none.</span></span> <span data-ttu-id="b3c63-125">Par conséquent, n'utilisez pas l'option **Nettoyage de la migration** comme alternative à l'option de suppression de configuration ER sur la page **Configurations**.</span><span class="sxs-lookup"><span data-stu-id="b3c63-125">Therefore, do not use the **Migration cleanup** option as an alternative to the ER configuration deletion option on the **Configurations** page.</span></span> <span data-ttu-id="b3c63-126">Utilisez l'option **Nettoyage de la migration** uniquement lorsque l'option de suppression de la configuration ER sur la page **Configurations** échoue.</span><span class="sxs-lookup"><span data-stu-id="b3c63-126">Use the **Migration cleanup** option only when the ER configuration deletion option on the **Configurations** page failed.</span></span>
>
> <span data-ttu-id="b3c63-127">Si vous utilisez l'option **Nettoyage de migration** pour supprimer la configuration au format ER lorsque le modèle référencé est disponible dans le stockage Blob, vous ne supprimez que les artefacts de configuration dans la base de données d'application.</span><span class="sxs-lookup"><span data-stu-id="b3c63-127">If you use the **Migration cleanup** option to delete an ER format configuration when the referred template is available in the Blob storage, you only delete related configuration artifacts in the application database.</span></span> <span data-ttu-id="b3c63-128">Le fichier physique du modèle dans le stockage Blob reste.</span><span class="sxs-lookup"><span data-stu-id="b3c63-128">The physical file of the template in the Blob storage remains.</span></span> <span data-ttu-id="b3c63-129">L'écrasement de fichiers dans le stockage Blob n'est plus autorisé.</span><span class="sxs-lookup"><span data-stu-id="b3c63-129">File overwriting in Blob storage is no longer allowed.</span></span> <span data-ttu-id="b3c63-130">Pour plus d'informations, voir [KB4557217](https://fix.lcs.dynamics.com/Issue/Details?kb=4557217).</span><span class="sxs-lookup"><span data-stu-id="b3c63-130">For more information, see [KB4557217](https://fix.lcs.dynamics.com/Issue/Details?kb=4557217).</span></span> <span data-ttu-id="b3c63-131">De plus, vous ne pourrez plus réimporter les configurations supprimées à l'aide du nettoyage de migration dans cet environnement.</span><span class="sxs-lookup"><span data-stu-id="b3c63-131">Additionally, you will no longer be able to re-import the configurations deleted by using the Migration cleanup in this environment.</span></span> <span data-ttu-id="b3c63-132">Pour résoudre ce problème, vous devez rechercher le fichier correspondant dans le stockage Blob et le supprimer manuellement.</span><span class="sxs-lookup"><span data-stu-id="b3c63-132">To resolve this issue, you need to find the corresponding file in Blob storage and manually delete it.</span></span>

<span data-ttu-id="b3c63-133">[![Importation d'un format ER](./media/er-migration-cleanup-import.png)](./media/er-migration-cleanup-import.png)</span><span class="sxs-lookup"><span data-stu-id="b3c63-133">[![Importing an ER format](./media/er-migration-cleanup-import.png)](./media/er-migration-cleanup-import.png)</span></span>

<span data-ttu-id="b3c63-134">Un problème similaire peut se produire si vous migrez votre instance d'application vers un autre emplacement qui a été utilisé comme cible de migration plusieurs fois et pour lequel le stockage Blob contient déjà des fichiers de modèle ER.</span><span class="sxs-lookup"><span data-stu-id="b3c63-134">A similar issue may occur if you migrate your application instance to another location that has been used as a migration target more than once and for which the Blob storage already contains ER template files.</span></span>

<span data-ttu-id="b3c63-135">En raison des nombreuses configurations du format de gestion des états électroniques, ce processus peut se révéler chronophage.</span><span class="sxs-lookup"><span data-stu-id="b3c63-135">Because you can have several ER format configurations, this process can be time consuming.</span></span> <span data-ttu-id="b3c63-136">Par conséquent, en utilisant la fonctionnalité [stockage de sauvegarde des modèles ER](er-backup-storage-templates.md) pour récupérer automatiquement les modèles avec des références cassées est préférable.</span><span class="sxs-lookup"><span data-stu-id="b3c63-136">Therefore, using the [Backup storage of ER templates](er-backup-storage-templates.md) feature to automatically recover templates with broken references is preferred.</span></span>
