---
title: Concepteur de formule dans les états électroniques (ER)
description: Cette rubrique fournit des informations sur l’utilisation du concepteur de formule dans les États électroniques (ER).
author: NickSelin
manager: kfend
ms.date: 12/05/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: ERDataModelDesigner, ERExpressionDesignerFormula, ERMappedFormatDesigner, ERModelMappingDesigner
audience: Application User, IT Pro
ms.reviewer: kfend
ms.custom: 58771
ms.assetid: 24223e13-727a-4be6-a22d-4d427f504ac9
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: d96fe041fd0ffb292909c1e724068efebe0184b9
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/05/2020
ms.locfileid: "4682647"
---
# <a name="formula-designer-in-electronic-reporting-er"></a><span data-ttu-id="d8a6a-103">Concepteur de formule dans les états électroniques (ER)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-103">Formula designer in Electronic reporting (ER)</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="d8a6a-104">Cette rubrique décrit l’utilisation du concepteur de formule dans la génération d’états électroniques.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-104">This topic explains how to use the formula designer in Electronic reporting (ER).</span></span> <span data-ttu-id="d8a6a-105">Lorsque vous créez un format pour un document électronique spécifique dans ER, vous pouvez utiliser des formules pour transformer les données afin qu’elles répondent aux exigences d’exécution et de mise en forme du document.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-105">When you design a format for a specific electronic document in ER, you can use formulas to transform data so that it meets the requirements for the document's fulfillment and formatting.</span></span> <span data-ttu-id="d8a6a-106">Ces formules sont semblables aux formules dans Microsoft Excel.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-106">These formulas resemble formulas in Microsoft Excel.</span></span> <span data-ttu-id="d8a6a-107">Plusieurs types de fonctions sont pris en charge dans les formules : texte, date et heure, mathématique, logique, informations, et des formules de conversion du type de données ainsi que d’autres fonctions spécifiques au métier.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-107">Various types of functions are supported in the formulas: text, date and time, mathematical, logical, information, and data type conversion functions, and also other, business domain–specific functions.</span></span>

## <a name="formula-designer-overview"></a><span data-ttu-id="d8a6a-108">Vue d’ensemble du concepteur de formule</span><span class="sxs-lookup"><span data-stu-id="d8a6a-108">Formula designer overview</span></span>

<span data-ttu-id="d8a6a-109">La fonctionnalité de génération d’états électroniques prend en charge le concepteur de formule.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-109">ER supports the formula designer.</span></span> <span data-ttu-id="d8a6a-110">Par conséquent, au moment de la conception, vous pouvez configurer des expressions qui peuvent être utilisées pour les tâches suivantes au moment de l’exécution :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-110">Therefore, at design time, you can configure expressions that can be used for the following tasks at runtime:</span></span>

- <span data-ttu-id="d8a6a-111">Transformez les données provenant d’une base de données d’une application, et qui doivent être saisies dans un modèle de données ER conçues pour être une source de données pour les formats ER.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-111">Transform data that is received from an application database and that should be entered in an ER data model that is designed to be a data source for ER formats.</span></span> <span data-ttu-id="d8a6a-112">(Par exemple, ces transformations peuvent inclure le filtrage, le regroupement et la conversion des types de données.)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-112">(For example, these transformations might include filtering, grouping, and data type conversion.)</span></span>
- <span data-ttu-id="d8a6a-113">Mettre en forme des données qui doivent être émises vers un document électronique en cours de génération en accord avec la mise en forme et les conditions d’un format de génération d’états électroniques spécifique.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-113">Format data that must be sent to a generating electronic document in accordance with the layout and conditions of a specific ER format.</span></span> <span data-ttu-id="d8a6a-114">(Par exemple, la mise en forme peut être effectuée en accord avec la langue, la culture ou le codage demandé.)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-114">(For example, the formatting might be done in accordance with the requested language or culture, or the encoding).</span></span>
- <span data-ttu-id="d8a6a-115">Contrôler le processus de création de documents électroniques.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-115">Control the process of creating electronic documents.</span></span> <span data-ttu-id="d8a6a-116">(Par exemple, les expressions peuvent activer ou désactiver l’émission d’éléments spécifiques du format, en fonction des données de traitement.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-116">(For example, the expressions can enable or disable the output of specific elements of the format, depending on processing data.</span></span> <span data-ttu-id="d8a6a-117">Elles peuvent également interrompre le processus de création du document ou envoyer des messages aux utilisateurs.)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-117">They can also interrupt the document creation process or throw messages to users.)</span></span>

<span data-ttu-id="d8a6a-118">Vous pouvez ouvrir la page **Concepteur de formule** lorsque vous effectuez l’une des actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-118">You can open the **Formula designer** page when you perform any of the following actions:</span></span>

- <span data-ttu-id="d8a6a-119">Lier des articles sources de données aux composants de modèle de données.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-119">Bind data source items to data model components.</span></span>
- <span data-ttu-id="d8a6a-120">Lier des articles sources de données aux composants de format.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-120">Bind data source items to format components.</span></span>
- <span data-ttu-id="d8a6a-121">Effectuer la mise à jour des champs calculés dans le cadre des sources de données.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-121">Complete maintenance of calculated fields that are part of data sources.</span></span>
- <span data-ttu-id="d8a6a-122">Définir des conditions de visibilité pour les paramètres d’entrée utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-122">Define the visibility conditions for user input parameters.</span></span>
- <span data-ttu-id="d8a6a-123">Créer des transformations d’un format.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-123">Design a format's transformations.</span></span>
- <span data-ttu-id="d8a6a-124">Définir les conditions d’activation pour les composants du format.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-124">Define the enabling conditions for the format's components.</span></span>
- <span data-ttu-id="d8a6a-125">Définir les noms de fichiers pour les composants FICHIER du format.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-125">Define the file names for the format's FILE components.</span></span>
- <span data-ttu-id="d8a6a-126">Définir les conditions des validations du contrôle de processus.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-126">Define the conditions for process control validations.</span></span>
- <span data-ttu-id="d8a6a-127">Définir le texte de message des validations du contrôle de processus.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-127">Define the message text for process control validations.</span></span>

## <a name="data-binding"></a><a name="Binding"></a><span data-ttu-id="d8a6a-128">Liaison de données</span><span class="sxs-lookup"><span data-stu-id="d8a6a-128">Data binding</span></span>

<span data-ttu-id="d8a6a-129">Le concepteur de formule de génération d’états électroniques permet de définir une expression qui transforme des données reçues des sources de données à saisir de la manière suivante dans le consommateur de données au moment de l’exécution :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-129">The ER formula designer can be used to define an expression that transforms data that is received from data sources, so that the data can be entered in the data consumer in the following ways at runtime:</span></span>

- <span data-ttu-id="d8a6a-130">Des sources de données de l’application et des paramètres d’exécution à un modèle de données de génération d’états électroniques</span><span class="sxs-lookup"><span data-stu-id="d8a6a-130">From application data sources and runtime parameters to an ER data model</span></span>
- <span data-ttu-id="d8a6a-131">D’un modèle de données de génération d’états électroniques à un format de génération d’états électroniques</span><span class="sxs-lookup"><span data-stu-id="d8a6a-131">From an ER data model to an ER format</span></span>
- <span data-ttu-id="d8a6a-132">Des sources de données de l’application et des paramètres d’exécution à format de génération d’états électroniques</span><span class="sxs-lookup"><span data-stu-id="d8a6a-132">From application data sources and runtime parameters to an ER format</span></span>

<span data-ttu-id="d8a6a-133">La figure suivante présente la création d’une expression de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-133">The following illustration shows the design of an expression of this type.</span></span> <span data-ttu-id="d8a6a-134">Dans cet exemple, l’expression arrondit la valeur du champ **Intrastat.AmountMST** dans la table Déclaration d’échanges de biens à deux décimales et retourne la valeur arrondie.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-134">In this example, the expression rounds the value of the **Intrastat.AmountMST** field in the Intrastat table to two decimal places and then returns the rounded value.</span></span>

<span data-ttu-id="d8a6a-135">[![Expression de liaison de données](./media/picture-expression-binding.jpg)](./media/picture-expression-binding.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-135">[![Data binding expression](./media/picture-expression-binding.jpg)](./media/picture-expression-binding.jpg)</span></span>

<span data-ttu-id="d8a6a-136">La figure suivante présente l’utilisation d’une expression de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-136">The following illustration shows how an expression of this type can be used.</span></span> <span data-ttu-id="d8a6a-137">Dans cet exemple, le résultat de l’expression conçue est saisi dans le composant **Transaction.InvoicedAmount** du modèle de données **Modèle de déclaration de taxe**.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-137">In this example, the result of the designed expression is entered in the **Transaction.InvoicedAmount** component of the **Tax reporting model** data model.</span></span>

<span data-ttu-id="d8a6a-138">[![Expression de liaison de données utilisée](./media/picture-expression-binding2.jpg)](./media/picture-expression-binding2.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-138">[![Data binding expression being used](./media/picture-expression-binding2.jpg)](./media/picture-expression-binding2.jpg)</span></span>

<span data-ttu-id="d8a6a-139">À l’exécution, la formule conçue, `ROUND (Intrastat.AmountMST, 2)`, arrondit la valeur du champ **AmountMST** pour chaque enregistrement de la table Déclaration d’échanges de biens à deux décimales.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-139">At runtime, the designed formula, `ROUND (Intrastat.AmountMST, 2)`, rounds the value of the **AmountMST** field for each record in the Intrastat table to two decimal places.</span></span> <span data-ttu-id="d8a6a-140">Elle saisit ensuite la valeur arrondie dans le composant **Transaction.InvoicedAmount** du modèle de données **Déclaration de taxe**.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-140">It then enters the rounded value in the **Transaction.InvoicedAmount** component of the **Tax reporting** data model.</span></span>

## <a name="data-formatting"></a><a name="Transformation"></a><span data-ttu-id="d8a6a-141">Mise en forme des données</span><span class="sxs-lookup"><span data-stu-id="d8a6a-141">Data formatting</span></span>

<span data-ttu-id="d8a6a-142">Le concepteur de formule de génération d’états électroniques permet de définir une expression qui formate les données reçues des sources de données, afin que les données puissent être envoyées dans le cadre de la génération d’un document électronique.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-142">The ER formula designer can be used to define an expression that formats data that is received from data sources, so that the data can be sent as part of the generating electronic document.</span></span> <span data-ttu-id="d8a6a-143">Vous disposez peut-être d’une mise en forme qui doit être appliquée comme règle classique pour être réutilisée pour un format.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-143">You might have formatting that must be applied as a typical rule that should be reused for a format.</span></span> <span data-ttu-id="d8a6a-144">Dans ce cas, vous pouvez entrer cette mise en forme une fois dans la configuration du format comme transformation nommée ayant une expression de mise en forme.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-144">In this case, you can introduce that formatting one time in the format configuration, as a named transformation that has a formatting expression.</span></span> <span data-ttu-id="d8a6a-145">Cette transformation nommée peut ensuite être liée à de nombreux composants de format dont la sortie doit être mise en forme en fonction de l’expression de mise en forme créée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-145">This named transformation can then be linked to many format components where the output must be formatted according to the formatting expression that you created.</span></span>

<span data-ttu-id="d8a6a-146">La figure suivante présente la création d’une transformation de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-146">The following illustration shows the design of a transformation of this type.</span></span> <span data-ttu-id="d8a6a-147">Dans cet exemple, la transformation **TrimmedString** tronque les données entrantes du type de données *Chaîne* en supprimant les espaces de début et de fin.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-147">In this example, the **TrimmedString** transformation truncates incoming data of the *String* data type by removing leading and trailing spaces.</span></span> <span data-ttu-id="d8a6a-148">Elle retourne ensuite la valeur de chaîne tronquée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-148">It then returns the truncated string value.</span></span>

<span data-ttu-id="d8a6a-149">[![Transformation](./media/picture-transformation-design.jpg)](./media/picture-transformation-design.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-149">[![Transformation](./media/picture-transformation-design.jpg)](./media/picture-transformation-design.jpg)</span></span>

<span data-ttu-id="d8a6a-150">La figure suivante présente l’utilisation d’une transformation de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-150">The following illustration shows how a transformation of this type can be used.</span></span> <span data-ttu-id="d8a6a-151">Dans cet exemple, plusieurs composants de format envoient le texte comme résultat de la génération du document électronique au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-151">In this example, several format components send text as output to the generating electronic document at runtime.</span></span> <span data-ttu-id="d8a6a-152">Tous ces composants de format font référence à la transformation **TrimmedString** par son nom.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-152">All these format components refer to the **TrimmedString** transformation by name.</span></span>

<span data-ttu-id="d8a6a-153">[![Transformation utilisée](./media/picture-transformation-usage.jpg)](./media/picture-transformation-usage.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-153">[![Transformation being used](./media/picture-transformation-usage.jpg)](./media/picture-transformation-usage.jpg)</span></span>

<span data-ttu-id="d8a6a-154">Lorsque les composants de format, comme le composant **partyName** dans l’illustration précédente, font référence à la transformation **TrimmedString**, cette dernière renvoie le texte comme résultat de la génération du document électronique.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-154">When format components, such as the **partyName** component in the preceding illustration, refer to the **TrimmedString** transformation, the transformation sends text as output to the generating electronic document.</span></span> <span data-ttu-id="d8a6a-155">Le texte n’inclut pas les espaces de début et de fin.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-155">This text doesn't include leading and trailing spaces.</span></span>

<span data-ttu-id="d8a6a-156">Si vous avez une mise en forme qui doit être appliquée individuellement, vous pouvez introduire cette mise en page en tant qu’expression individuelle d’une liaison d’un composant de format spécifique.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-156">If you have formatting that must be applied individually, you can introduce that formatting as an individual expression of a binding of a specific format component.</span></span> <span data-ttu-id="d8a6a-157">La figure suivante présente une expression de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-157">The following illustration shows an expression of this type.</span></span> <span data-ttu-id="d8a6a-158">Dans cet exemple, le composant de format **partyType** est lié à la source de données via une expression qui convertit les données entrantes du champ **Model.Company.RegistrationType** dans la source de données en texte en majuscules.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-158">In this example, the **partyType** format component is bound to the data source via an expression that converts incoming data from the **Model.Company.RegistrationType** field in the data source to uppercase text.</span></span> <span data-ttu-id="d8a6a-159">L’expression envoie ensuite ce texte comme résultat dans le document électronique.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-159">The expression then sends that text as output to the electronic document.</span></span>

<span data-ttu-id="d8a6a-160">[![Application de la mise en forme à un composant individuel](./media/picture-binding-with-formula.jpg)](./media/picture-binding-with-formula.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-160">[![Applying formatting to an individual component](./media/picture-binding-with-formula.jpg)](./media/picture-binding-with-formula.jpg)</span></span>

## <a name="process-flow-control"></a><a name="Validation"></a><span data-ttu-id="d8a6a-161">Contrôle des flux de processus</span><span class="sxs-lookup"><span data-stu-id="d8a6a-161">Process flow control</span></span>

<span data-ttu-id="d8a6a-162">Le concepteur de formule de génération d’états électroniques permet de définir les expressions utilisées pour contrôler le flux de processus de génération de documents électroniques.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-162">The ER formula designer can be used to define expressions that control the process flow of generating electronic documents.</span></span> <span data-ttu-id="d8a6a-163">Vous pouvez effectuer les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-163">You can perform the following tasks:</span></span>

- <span data-ttu-id="d8a6a-164">Définir des conditions qui déterminent quand un processus de création de document doit être arrêté.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-164">Define conditions that determine when a document creation process must be stopped.</span></span>
- <span data-ttu-id="d8a6a-165">Spécifier les expressions qui créent des messages pour l’utilisateur, relatifs aux processus arrêtés ou lancent des messages de journal d’exécution relatifs à la continuité du processus de génération d’états.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-165">Specify expressions that either create messages for the user about stopped processes or throw execution log messages about the continuing process of report generation.</span></span>
- <span data-ttu-id="d8a6a-166">Spécifier les noms de fichier de la génération de documents électroniques, et contrôler les conditions de leur création.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-166">Specify the file names of generating electronic documents, and control the conditions of their creation.</span></span>

<span data-ttu-id="d8a6a-167">Chaque règle du contrôle des flux de processus est conçue comme un contrôle individuel.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-167">Each rule of the process flow control is designed as an individual validation.</span></span> <span data-ttu-id="d8a6a-168">La figure suivante présente une validation de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-168">The following illustration shows a validation of this type.</span></span> <span data-ttu-id="d8a6a-169">Voici une explication de la configuration dans cet exemple :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-169">Here is an explanation of the configuration in this example:</span></span>

- <span data-ttu-id="d8a6a-170">La validation est évaluée lorsque le nœud **INSTAT** est créé lors de la génération du fichier XML.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-170">The validation is evaluated when the **INSTAT** node is created during generation of the XML file.</span></span>
- <span data-ttu-id="d8a6a-171">Si la liste des transactions est vide, la validation arrête le processus d’exécution et renvoie la valeur **FALSE**.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-171">If the list of transactions is empty, the validation stops the execution process and returns **FALSE**.</span></span>
- <span data-ttu-id="d8a6a-172">La validation renvoie un message d’erreur qui inclut le texte du libellé SYS70894 dans la langue de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-172">The validation returns an error message that includes the text of label SYS70894 in the user's preferred language.</span></span>

<span data-ttu-id="d8a6a-173">[![Validation](./media/picture-validation.jpg)](./media/picture-validation.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-173">[![Validation](./media/picture-validation.jpg)](./media/picture-validation.jpg)</span></span>

<span data-ttu-id="d8a6a-174">Le concepteur de formule de génération d’états électroniques peut également être utilisé pour générer un nom de fichier permettant de générer un document électronique et de contrôler le processus de création de fichier.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-174">The ER formula designer can also be used to generate a file name for a generating electronic document and to control the file creation process.</span></span> <span data-ttu-id="d8a6a-175">La figure suivante présente la création d’un contrôle des flux de processus de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-175">The following illustration shows the design of a process flow control of this type.</span></span> <span data-ttu-id="d8a6a-176">Voici une explication de la configuration dans cet exemple :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-176">Here is an explanation of the configuration in this example:</span></span>

- <span data-ttu-id="d8a6a-177">La liste des enregistrements de la source de données **model.Intrastat** est divisée en lots.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-177">The list of records from the **model.Intrastat** data source is divided into batches.</span></span> <span data-ttu-id="d8a6a-178">Chaque lot contient jusqu’à 1 000 enregistrements.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-178">Each batch contains up to 1,000 records.</span></span>
- <span data-ttu-id="d8a6a-179">Le résultat crée un fichier zip qui contient un fichier au format XML pour chaque lot qui a été créé.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-179">The output creates a zip file that contains one file in XML format for every batch that was created.</span></span>
- <span data-ttu-id="d8a6a-180">Une expression renvoie un nom de fichier pour générer des documents électroniques en concaténant le nom de fichier et son extension.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-180">An expression returns a file name for generating electronic documents by concatenating the file name and the file name extension.</span></span> <span data-ttu-id="d8a6a-181">Pour le deuxième traitement par lots et tous les traitements par lots suivants, le nom de fichier contient l’ID traitement par lots comme suffixe.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-181">For the second batch and all subsequent batches, the file name contains the batch ID as a suffix.</span></span>
- <span data-ttu-id="d8a6a-182">Une expression active (en renvoyant la valeur **TRUE**) le processus de création de fichier pour les lots contenant au moins un enregistrement.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-182">An expression enables (by returning **TRUE**) the file creation process for batches that contain at least one record.</span></span>

<span data-ttu-id="d8a6a-183">[![Contrôle des flux de processus](./media/picture-file-control.jpg)](./media/picture-file-control.jpg)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-183">[![Process flow control](./media/picture-file-control.jpg)](./media/picture-file-control.jpg)</span></span>

## <a name="document-content-control"></a><a name="Enabled"></a><span data-ttu-id="d8a6a-184">Contrôle du contenu des documents</span><span class="sxs-lookup"><span data-stu-id="d8a6a-184">Document content control</span></span>

<span data-ttu-id="d8a6a-185">Le concepteur de formule de génération d’états électroniques peut être utilisé pour configurer les expressions contrôlant quelles données sont placées dans les documents électroniques générés au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-185">The ER formula designer can be used to configure expressions that control what data will be put into generated electronic documents at runtime.</span></span> <span data-ttu-id="d8a6a-186">Les expressions peuvent activer ou désactiver l’émission d’éléments spécifiques du format, en fonction des données de traitement et de la logique configurée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-186">The expressions can enable or disable the output of specific elements of the format, depending on processing data and configured logic.</span></span> <span data-ttu-id="d8a6a-187">Ces expressions peuvent être entrées pour un seul élément de format dans le champ **Activé** sur l’onglet **Mise en correspondance** sur la page **Concepteur des opérations**.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-187">These expressions can be entered for a single format element in the **Enabled** field on the **Mapping** tab of the **Operations designer** page.</span></span> <span data-ttu-id="d8a6a-188">Vous pouvez entrer les expressions sous la forme d’une condition logique retournant une valeur *Booléenne* :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-188">You can enter the expressions as a logic condition that returns a *Boolean* value:</span></span>

- <span data-ttu-id="d8a6a-189">Si la condition renvoie **True**, l’élément de format actuel est exécuté.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-189">If the condition returns **True**, the current format element is run.</span></span>
- <span data-ttu-id="d8a6a-190">Si la condition renvoie **False**, l’élément de format actuel est ignoré.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-190">If the condition returns **False**, the current format element is skipped.</span></span>

<span data-ttu-id="d8a6a-191">La figure suivante présente des expressions de ce type.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-191">The following illustration shows expressions of this type.</span></span> <span data-ttu-id="d8a6a-192">(La version 11.12.11 de la configuration de format du **Format du virement bancaire ISO20022 (NO)** fournie par Microsoft est utilisée comme exemple.) Le composant de format **XMLHeader** est configuré pour décrire la structure du message de virement selon les normes de message XML ISO 20022.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-192">(Version 11.12.11 of the **ISO20022 Credit transfer (NO)** format configuration that is provided by Microsoft is used as an example.) The **XMLHeader** format component is configured to describe the structure of the credit transfer message according to the ISO 20022 XML message standards.</span></span> <span data-ttu-id="d8a6a-193">Le composant de format **XMLHeader/Document/CstmrCdtTrfInitn/PmtInf/CdtTrfTxInf/RmtInf/Ustrd** est configuré pour ajouter l’élément XML **Ustrd** au message généré et pour placer les informations de remise dans un format non structuré comme texte des éléments XML suivants :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-193">The **XMLHeader/Document/CstmrCdtTrfInitn/PmtInf/CdtTrfTxInf/RmtInf/Ustrd** format component is configured to add the **Ustrd** XML element to the generated message and to put the remittance information in an unstructured format as text of the following XML elements:</span></span>

- <span data-ttu-id="d8a6a-194">Le composant **PaymentNotes** est utilisé pour générer le texte des notes de paiement.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-194">The **PaymentNotes** component is used to generate the text of payment notes.</span></span>
- <span data-ttu-id="d8a6a-195">Le composant **DelimitedSequence** génère les numéros de facture séparés par une virgule utilisés pour régler le transfert actuel de crédit.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-195">The **DelimitedSequence** component generates comma-separated invoice numbers that are used to settle the current credit transfer.</span></span>

<span data-ttu-id="d8a6a-196">[![Composants PaymentNotes et DelimitedSequence](./media/GER-FormulaEditor-ControlContent-1.png)](./media/GER-FormulaEditor-ControlContent-1.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-196">[![PaymentNotes and DelimitedSequence components](./media/GER-FormulaEditor-ControlContent-1.png)](./media/GER-FormulaEditor-ControlContent-1.png)</span></span>

> [!NOTE]
> <span data-ttu-id="d8a6a-197">Les composants **PaymentNotes** et **DelimitedSequence** sont libellés à l’aide d’un point d’interrogation.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-197">The **PaymentNotes** and **DelimitedSequence** components are labeled by using a question mark.</span></span> <span data-ttu-id="d8a6a-198">Un point d’interrogation indique que l’utilisation d’un composant est conditionnelle.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-198">A question mark indicates that the use of a component is conditional.</span></span> <span data-ttu-id="d8a6a-199">Dans ce cas, l’utilisation des composants est basée sur les critères suivants :</span><span class="sxs-lookup"><span data-stu-id="d8a6a-199">In this case, use of the components is based on the following criteria:</span></span>
>
> - <span data-ttu-id="d8a6a-200">L’expression `@.PaymentsNotes <> ""` définie pour le composant **PaymentNotes**, active (en retournant **TRUE**) l’élément XML **Ustrd** à renseigner avec le texte des notes de paiement, si ce texte pour le virement actuel n’est pas vide.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-200">The `@.PaymentsNotes <> ""` expression that is defined for the **PaymentNotes** component enables (by returning **TRUE**) the **Ustrd** XML element to be filled with the text of payment notes, if that text isn't blank for the current credit transfer.</span></span>
>
>    <span data-ttu-id="d8a6a-201">[![Expression pour le composant PaymentNotes](./media/GER-FormulaEditor-ControlContent-2.png)](./media/GER-FormulaEditor-ControlContent-2.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-201">[![Expression for the PaymentNotes component](./media/GER-FormulaEditor-ControlContent-2.png)](./media/GER-FormulaEditor-ControlContent-2.png)</span></span>
>
> - <span data-ttu-id="d8a6a-202">L’expression `@.PaymentsNotes = ""` définie pour le composant **DelimitedSequence** active (en retournant **TRUE**) l’élément **XML Ustrd** à renseigner avec une liste des numéros de facture séparés par une virgule qui sont utilisés pour régler le virement actuel si le texte des notes de paiement pour ce virement est vide.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-202">The `@.PaymentsNotes = ""` expression that is defined for the **DelimitedSequence** component enables (by returning **TRUE**) the **Ustrd** XML element to be filled with a comma-separated list of the invoice numbers that are used to settle the current credit transfer, if the text of payment notes for that credit transfer is blank.</span></span>
>
>    <span data-ttu-id="d8a6a-203">[![Expression pour le composant DelimitedSequence](./media/GER-FormulaEditor-ControlContent-3.png)](./media/GER-FormulaEditor-ControlContent-3.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-203">[![Expression for the DelimitedSequence component](./media/GER-FormulaEditor-ControlContent-3.png)](./media/GER-FormulaEditor-ControlContent-3.png)</span></span>
> 
> <span data-ttu-id="d8a6a-204">Selon cette configuration, le message généré pour chaque paiement de débit, l’élément XML **Ustrd**, contient soit le texte des notes de paiement soit, si ce texte est vide, une liste des numéros de facture séparés par une virgule utilisés pour régler le paiement.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-204">Based on this setup, the message that is generated for each debtor payment, the **Ustrd** XML element, will contain either the text of payment notes or, when that text is blank, a comma-separated list of the invoice numbers that are used to settle the payment.</span></span>

## <a name="validation-of-configured-formulas"></a><a name="TestFormula"></a><span data-ttu-id="d8a6a-205">Validation des formules configurées</span><span class="sxs-lookup"><span data-stu-id="d8a6a-205">Validation of configured formulas</span></span>

<span data-ttu-id="d8a6a-206">Sur la page **Concepteur de formule**, sélectionnez **Tester** pour valider le fonctionnement de la formule configurée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-206">On the **Formula designer** page, select **Test** to validate how the configured formula works.</span></span>

<span data-ttu-id="d8a6a-207">[![Sélection du test pour valider une formule](./media/ER-FormulaTest-Start.png)](./media/ER-FormulaTest-Start.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-207">[![Selecting Test to validate a forumula](./media/ER-FormulaTest-Start.png)](./media/ER-FormulaTest-Start.png)</span></span>

<span data-ttu-id="d8a6a-208">Lorsque les valeurs des arguments de formule sont requises, vous pouvez ouvrir la boîte de dialogue **Tester l’expression** sur la page **Concepteur de formule**.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-208">When the values of formula arguments are required, you can open the **Test expression** dialog box from the **Formula designer** page.</span></span> <span data-ttu-id="d8a6a-209">Dans la plupart des cas, ces arguments doivent être définis manuellement, car les liaisons configurées ne sont pas exécutées au moment de la conception.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-209">In most cases, these arguments must be manually defined, because the configured bindings aren't run at design time.</span></span> <span data-ttu-id="d8a6a-210">L’onglet **Résultat du test** sur la **Concepteur de formule** affiche le résultat de l’exécution de la formule configurée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-210">The **Test result** tab on the **Formula designer** page shows the result from execution of the configured formula.</span></span>

<span data-ttu-id="d8a6a-211">L’exemple suivant montre comment tester la formule configurée pour le domaine du commerce extérieur pour vous assurer que le code de marchandise de la déclaration d’échanges de biens ne contient que des chiffres.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-211">The following example shows how you can test the formula that is configured for the foreign trade domain to make sure that the Intrastat commodity code contains only digits.</span></span>

<span data-ttu-id="d8a6a-212">Lorsque vous testez cette formule, vous pouvez utiliser la boîte de dialogue **Tester l’expression** pour spécifier la valeur du code de produit de la déclaration d’échanges de biens à tester.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-212">When you test this formula, you can use the **Test expression** dialog box to specify the value of the Intrastat commodity code for testing.</span></span>

<span data-ttu-id="d8a6a-213">[![Spécification du code de produit de la déclaration d’échanges de biens pour les tests](./media/ER-FormulaTest-Start-EnterArguments.png)](./media/ER-FormulaTest-Start-EnterArguments.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-213">[![Specifying the Intrastat commodity code for testing](./media/ER-FormulaTest-Start-EnterArguments.png)](./media/ER-FormulaTest-Start-EnterArguments.png)</span></span>

<span data-ttu-id="d8a6a-214">Après avoir spécifié le code de marchandise de la déclaration d’échanges de biens et sélectionné **OK**, l’onglet **Résultat du test** sur la page **Concepteur de formule** affiche le résultat de l’exécution de la formule configurée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-214">After you specify the Intrastat commodity code and select **OK**, the **Test result** tab on the **Formula designer** page shows the result of execution of the configured formula.</span></span> <span data-ttu-id="d8a6a-215">Vous pouvez ensuite évaluer si le résultat est acceptable.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-215">You can then evaluate whether the result is acceptable.</span></span> <span data-ttu-id="d8a6a-216">Si le résultat n’est pas acceptable, vous pouvez mettre à jour la formule et la tester à nouveau.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-216">If the result isn't acceptable, you can update the formula and test it again.</span></span>

<span data-ttu-id="d8a6a-217">[![Résultat du test](./media/ER-FormulaTest-Result.png)](./media/ER-FormulaTest-Result.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-217">[![Test result](./media/ER-FormulaTest-Result.png)](./media/ER-FormulaTest-Result.png)</span></span>

<span data-ttu-id="d8a6a-218">Certaines formules ne peuvent pas être testées au moment de la conception.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-218">Some formulas can't be tested at design time.</span></span> <span data-ttu-id="d8a6a-219">Par exemple, une formule peut renvoyer le résultat d’un type de données qui ne peut pas être affiché sur l’onglet **Résultat du test**. Dans ce cas, vous recevez un message d’erreur indiquant que la formule ne peut pas être testée.</span><span class="sxs-lookup"><span data-stu-id="d8a6a-219">For example, a formula might return a result of a data type that can't be shown on the **Test result** tab. In this case, you receive an error message that states that the formula can't be tested.</span></span>

<span data-ttu-id="d8a6a-220">[![Message d’erreur](./media/ER-FormulaTest-Error.png)](./media/ER-FormulaTest-Error.png)</span><span class="sxs-lookup"><span data-stu-id="d8a6a-220">[![Error message](./media/ER-FormulaTest-Error.png)](./media/ER-FormulaTest-Error.png)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d8a6a-221">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="d8a6a-221">Additional resources</span></span>

- [<span data-ttu-id="d8a6a-222">Vue d’ensemble des États électroniques</span><span class="sxs-lookup"><span data-stu-id="d8a6a-222">Electronic Reporting overview</span></span>](general-electronic-reporting.md)
- [<span data-ttu-id="d8a6a-223">Langage de formule dans la gestion des états électroniques</span><span class="sxs-lookup"><span data-stu-id="d8a6a-223">Electronic reporting formula language</span></span>](er-formula-language.md)
